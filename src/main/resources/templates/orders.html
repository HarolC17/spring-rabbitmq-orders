<!DOCTYPE html>
<!-- Declaración del tipo de documento HTML5 -->
<html xmlns:th="http://www.thymeleaf.org">
<!-- Definición del elemento raíz HTML con soporte para Thymeleaf -->
<head>
    <!-- Configuración del conjunto de caracteres UTF-8 para soportar caracteres especiales -->
    <meta charset="UTF-8">
    <!-- Título de la página que se mostrará en la pestaña del navegador -->
    <title>Gestión de Pedidos</title>
    <!-- Inclusión de la biblioteca CSS de Bootstrap para estilos predefinidos -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="container mt-4">
<!-- Cuerpo de la página con clase de Bootstrap para un contenedor y margen superior -->
<h1 class="mb-4">Gestión de Pedidos</h1>
<!-- Encabezado principal con margen inferior -->

<!-- Formulario para crear un nuevo pedido -->
<form id="orderForm" class="mb-4">
    <!-- Campo para el ID del pedido -->
    <div class="mb-3">
        <label for="orderId" class="form-label">Id</label>
        <input type="text" class="form-control" id="orderId" required>
        <!-- Campo de texto para el ID, obligatorio -->
    </div>
    <!-- Campo para el nombre del cliente -->
    <div class="mb-3">
        <label for="customer" class="form-label">Cliente</label>
        <input type="text" class="form-control" id="customer" required>
        <!-- Campo de texto para el cliente, obligatorio -->
    </div>
    <!-- Campo para el nombre del perfume -->
    <div class="mb-3">
        <label for="perfume" class="form-label">Perfume</label>
        <input type="text" class="form-control" id="perfume" required>
        <!-- Campo de texto para el perfume, obligatorio -->
    </div>
    <!-- Campo para la cantidad del pedido -->
    <div class="mb-3">
        <label for="quantity" class="form-label">Cantidad</label>
        <input type="number" class="form-control" id="quantity" required>
        <!-- Campo numérico para la cantidad, obligatorio -->
    </div>
    <!-- Campo para el total del pedido -->
    <div class="mb-3">
        <label for="total" class="form-label">Total</label>
        <input type="number" step="0.01" class="form-control" id="total" required>
        <!-- Campo numérico con dos decimales para el total, obligatorio -->
    </div>
    <!-- Botón para enviar el formulario -->
    <button type="submit" class="btn btn-primary">Enviar Pedido</button>
</form>

<!-- Sección para mostrar la tabla de pedidos -->
<h2>Pedidos Registrados</h2>
<!-- Encabezado para la tabla -->
<table class="table table-bordered table-striped" id="ordersTable">
    <!-- Tabla con estilos de Bootstrap para bordes y rayas -->
    <thead class="table-dark">
    <!-- Encabezado de la tabla con fondo oscuro -->
    <tr>
        <th>ID</th>
        <th>Cliente</th>
        <th>Perfume</th>
        <th>Cantidad</th>
        <th>Total</th>
    </tr>
    </thead>
    <tbody>
    <!-- Cuerpo de la tabla donde se cargarán los pedidos dinámicamente -->
    </tbody>
</table>

<script>
<!-- Sección de JavaScript para la lógica del cliente -->
<script>
    // Función asíncrona para cargar los pedidos desde el servidor
    async function loadOrders() {
        // Realiza una solicitud GET a la API para obtener los pedidos
        const response = await fetch("/api/orders/results");
        if (response.ok) {
            // Si la respuesta es exitosa, convierte los datos a JSON
            const orders = await response.json();
            // Selecciona el cuerpo de la tabla
            const tbody = document.querySelector("#ordersTable tbody");
            // Limpia el contenido previo de la tabla
            tbody.innerHTML = "";

            // Itera sobre los pedidos y crea filas para la tabla
            orders.forEach(order => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${order.orderId}</td>
                    <td>${order.customer}</td>
                    <td>${order.perfume}</td>
                    <td>${order.quantity}</td>
                    <td>$${order.total.toFixed(2)}</td>
                `;
                // Agrega la fila al cuerpo de la tabla
                tbody.appendChild(row);
            });
        }
    }

    // Evento para manejar el envío del formulario
    document.getElementById("orderForm").addEventListener("submit", async function (e) {
        // Previene el comportamiento por defecto del formulario
        e.preventDefault();

        // Crea un objeto con los datos del formulario
        const order = {
            orderId: document.getElementById("orderId").value,
            customer: document.getElementById("customer").value,
            perfume: document.getElementById("perfume").value,
            quantity: parseInt(document.getElementById("quantity").value),
            total: parseFloat(document.getElementById("total").value)
        };

        // Realiza una solicitud POST para enviar el pedido al servidor
        const response = await fetch("/api/orders/send", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify(order)
        });

        // Verifica si la solicitud fue exitosa
        if (response.ok) {
            // Muestra una alerta de éxito
            alert("Pedido enviado correctamente");
            // Resetea el formulario
            document.getElementById("orderForm").reset();
            // Refresca la tabla de pedidos
            await loadOrders();
        } else {
            // Muestra una alerta de error
            alert("Error al enviar el pedido");
        }
    });

    // Carga los pedidos al abrir la página
    loadOrders();
</script>
</body>
</html>
